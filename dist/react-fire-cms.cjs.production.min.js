"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),a=require("reactfire"),r=require("firebase/auth"),l=require("firebase/database"),o=require("firebase/storage"),i=require("firebase/firestore"),c=require("react-icons/io5");require("react-draft-wysiwyg/dist/react-draft-wysiwyg.css");var u=require("react-hotkeys-hook"),s=require("react-icons/fa"),m=require("draft-js"),d=require("react-draft-wysiwyg"),_=e(require("draftjs-to-html")),f=e(require("html-to-draftjs"));function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var E=function(e){var t=e.title,a=e.children,r=e.buttons,l=e.onClose;return e.open?n.createElement(n.Fragment,null,n.createElement("div",{className:"RFC__AntiClick"}),n.createElement("div",{className:"RFC__Dialog"},n.createElement("div",{className:"RFC__Dialog__Header"},t,l&&n.createElement(c.IoCloseSharp,{onClick:l,className:"RFC__Dialog__Close"})),n.createElement("div",{className:"RFC__Dialog__Content"},a),r&&n.createElement("div",{className:"RFC__Dialog__Buttons"},null==r?void 0:r.map((function(e){return n.createElement("div",{key:e.label,className:"RFC__Dialog__Buttons__Button "+(e.disabled&&"RFC__Dialog__Buttons__Button--disabled")+" RFC__Dialog__Buttons__Button--"+e.type,onClick:function(){e.disabled||e.action()}},e.label)}))))):null},v=function(e){var a=e.image,r=e.selected,l=e.onSelect,i=t.useState(""),c=i[0],u=i[1];return t.useEffect((function(){a&&o.getDownloadURL(a).then(u).catch(console.error)}),[a]),n.createElement("div",{onClick:function(){return l(c)},className:"RFC__MediaSelector__Item "+(r&&"RFC__MediaSelector__Item--Selected")},n.createElement("img",{src:c,alt:null==a?void 0:a.name,className:"RFC__MediaSelector__Item__Image"}),n.createElement("span",{className:"RFC__MediaSelector__Item__Text"},null==a?void 0:a.name))},g=function(e){var r=e.onSelect,l=w(),i=t.useState(""),c=i[0],u=i[1],s=t.useState(!1),m=s[0],d=s[1],_=t.useState([]),f=_[0],p=_[1],g=t.useState(-1),C=g[0],b=g[1],h=t.useState(""),F=h[0],S=h[1],y=a.useStorage(),k=t.useCallback((function(e){e.preventDefault(),d(!0)}),[d]);t.useEffect((function(){m&&o.listAll(o.ref(y,l.firebase.storage.bucket)).then((function(e){p(e.items)})).catch((function(e){return u(e)}))}),[y,m]);var N=t.useMemo((function(){return[{label:"Cancel",action:function(){return d(!1)}},{label:"Upload",action:function(){}},{label:"Select",action:function(){r(F),d(!1)},disabled:-1===C}]}),[r,C,F]);return n.createElement("div",null,n.createElement("button",{onClick:k},"Select Image"),m&&n.createElement(E,{buttons:N,title:"Media Gallery",open:m,onClose:function(){return d(!1)}},c&&n.createElement("span",{className:"RFC__TextStyles__Error"},c),n.createElement("div",{className:"RFC__MediaSelector__Grid"},f.map((function(e,t){return n.createElement(v,{onSelect:function(e){b(t),S(e)},selected:t===C,image:e})})))))},C=function(e){var t=e.onUpdateField,a=e.path;return n.createElement("div",{className:"RFC__Editable__Dialog__Image"},n.createElement("input",{onChange:function(e){return t(a,e.target.value)},id:a,value:e.value}),n.createElement(g,{onSelect:function(e){return t(a,e)}}))},b=function(e){var t=e.onUpdateField,a=e.path;return n.createElement(n.Fragment,null,n.createElement("input",{type:"number",onChange:function(e){return t(a,e.target.value)},id:a,value:e.value}))},h={name:"Parallax",key:"Parallax",component:function(e){var a=e.src,r=e.zoom,l=t.createRef(),o=t.useState(-1),i=o[0],c=o[1],u=t.useCallback((function(){var e,t,n=((null==(e=l.current)||null==(t=e.getBoundingClientRect())?void 0:t.top)||0)/window.innerHeight/2;c(n-1)}),[l]);return t.useEffect((function(){return window.addEventListener("scroll",u),function(){window.removeEventListener("scroll",u)}}),[u]),n.createElement("div",{ref:l,className:"RFC__Parallax"},n.createElement("div",{className:"RFC__Parallax__Inner",style:{backgroundImage:"url("+a+")",width:"100%",height:"calc(100% + "+2*r+"px)",backgroundPositionY:"calc("+r*i+"px)"}}))},Editor:function(e){var a=e.onDataSet,r=JSON.parse(e.data||"{}"),l=t.useState((null==r?void 0:r.src)||""),o=l[0],i=l[1],c=t.useState((null==r?void 0:r.zoom)||"0"),u=c[0],s=c[1];return t.useEffect((function(){a(JSON.stringify({src:o,zoom:u}))}),[o,u]),n.createElement("div",{className:"RFC__EditorStyles__Editor__Form"},n.createElement("span",null,"Source"),n.createElement(C,{value:r.src,path:"",onUpdateField:function(e,t){return i(t)}}),n.createElement("span",null,"Zoom"),n.createElement(b,{value:r.zoom,path:"",onUpdateField:function(e,t){return s(t)}}))}},F=function(e){var t=e.onUpdateField,a=e.path;return n.createElement(n.Fragment,null,n.createElement("input",{onChange:function(e){return t(a,e.target.value)},id:a,value:e.value}))},S=function(e){var t=e.alt,a=e.style,r=e.imageStyle,l=e.textStyle,o=e.imageClass,i=e.textClass,c=e.src;return null!=c&&c.startsWith("http")?n.createElement("img",{src:c,style:p({},a,r),className:o,alt:t}):n.createElement("span",{style:p({},a,l),className:i},c)},y={name:"Image / Text",key:"imageText",component:S,Editor:function(e){var a=e.onDataSet,r=JSON.parse(e.data),l=t.useState(null==r?void 0:r.src),o=l[0],i=l[1];return t.useEffect((function(){a(JSON.stringify({src:o}))}),[o]),n.createElement("div",{className:"RFC__EditorStyles__Editor__Form"},n.createElement("span",null,"Source"),n.createElement(F,{value:r.src,path:"",onUpdateField:function(e,t){return i(t)}}))}},k=t.createContext(null),N=function(e){var t=e.children,r=w();return n.createElement(a.FirebaseAppProvider,{firebaseConfig:r.firebase.config},t)},R=function(e){var t=e.children,c=a.useFirebaseApp(),u=l.getDatabase(c),s=r.getAuth(c),m=o.getStorage(c),d=i.getFirestore(c);return n.createElement(a.AuthProvider,{sdk:s},n.createElement(a.DatabaseProvider,{sdk:u},n.createElement(a.StorageProvider,{sdk:m},n.createElement(a.FirestoreProvider,{sdk:d},t))))},w=function(){return t.useContext(k)},D=function(e){var t=e.onUpdateField,a=e.path,r=f(e.value),l=m.ContentState.createFromBlockArray(r.contentBlocks,r.entityMap),o=m.EditorState.createWithContent(l);return n.createElement(n.Fragment,null,n.createElement("div",{className:"RFC__Editable__Dialog__RichEditor"},n.createElement(d.Editor,{defaultEditorState:o,onEditorStateChange:function(e){t(a,_(m.convertToRaw(e.getCurrentContent())))}})))},x=function(e){var a,r=e.onUpdateField,l=e.path,o=JSON.parse(e.value||"{}"),i=w(),c=t.useState(o.component||""),u=c[0],s=c[1],m=t.useState(o.data||"{}"),d=m[0],_=m[1];t.useEffect((function(){r(l,JSON.stringify({component:u,data:d}))}),[d,u]);var f=t.useCallback((function(e){s(e.target.value)}),[]),p=t.useCallback((function(e){_(e)}),[]),E=null==(a=i.components.find((function(e){return e.key===u})))?void 0:a.Editor;return n.createElement(n.Fragment,null,n.createElement("select",{value:u,onChange:f},n.createElement("option",null,"Select a Component"),i.components.map((function(e){return n.createElement("option",{value:e.key},e.name)}))),E&&n.createElement(E,{onDataSet:p,data:d}))},P=function(e){var r=e.open,l=e.fields,o=e.path,c=e.onClose,u=a.useFirestore(),s=i.doc(u,o),m=a.useFirestoreDocData(s),d=t.useState(""),_=d[0],f=d[1],v=t.useState({}),g=v[0],b=v[1];t.useEffect((function(){b(l.reduce((function(e,t){var n,a=e;return a[t.name]=(null==(n=m.data)?void 0:n[t.name])||"",a}),{}))}),[l,m]);var h=function(e){null==e||e.preventDefault(),i.setDoc(s,g,{merge:!0}).then(c).catch((function(e){return f(e)}))},S=t.useCallback((function(e,t){var n=p({},g);n[e]=t,b(n)}),[g]),y=[{label:"Cancel",action:function(){return null==c?void 0:c()}},{label:"Save",action:h}];return n.createElement(E,Object.assign({title:"Edit Fields"},{onClose:c,open:r},{buttons:y}),r&&n.createElement("form",{className:"RFC__Editable__Dialog",onSubmit:h},n.createElement("span",{className:"Text__Error"},_),null==l?void 0:l.map((function(e){return n.createElement("div",{key:e.name,className:"RFC__Editable__Dialog__Field"},n.createElement("div",{className:"RFC__Editable__Dialog__Label"},e.hint||e.name),function(e){switch(e.type){case"string":return n.createElement(F,{onUpdateField:S,path:e.name,value:g[e.name]});case"image":return n.createElement(C,{onUpdateField:S,path:e.name,value:g[e.name]});case"longform":return n.createElement(D,{onUpdateField:S,path:e.name,value:g[e.name]});case"component":return n.createElement(x,{onUpdateField:S,path:e.name,value:g[e.name]});default:return n.createElement(n.Fragment,null)}}(e))}))))};exports.Dialog=E,exports.DynamicComponent=function(e){var t,a=e.content,r=e.className,l=e.style,o=w(),i=JSON.parse(a||"{}"),c=null==i?void 0:i.component,u=JSON.parse((null==i?void 0:i.data)||"{}"),s=null==(t=o.components.find((function(e){return e.key===c})))?void 0:t.component;return s?n.createElement(s,Object.assign({},u,{className:r,style:l})):n.createElement(n.Fragment,null)},exports.Editable=function(e){var r=e.fields,l=e.style,o=e.path,i=e.className,c=e.children,m=a.useUser(),d=t.useState(!1),_=d[0],f=d[1],p=t.useState(!1),E=p[0],v=p[1],g=t.useState(!1),C=g[0],b=g[1];return u.useHotkeys("e",(function(){v(!0)})),u.useHotkeys("e",(function(){v(!1)}),{keydown:!1,keyup:!0}),u.useHotkeys("p",(function(){b(!0)})),u.useHotkeys("p",(function(){b(!1)}),{keydown:!1,keyup:!0}),m.data?n.createElement("div",{style:l,className:i+" RFC__Editable "+(C&&"RFC__Editable--Preview")},c,n.createElement(P,{path:o,open:_,fields:r,onClose:function(){return f(!1)}}),n.createElement("div",{className:"RFC__Editable__Pencil "+(E&&"RFC__Editable__Pencil--Highlight")+" "+(C&&"RFC__Editable__Pencil--Preview")},n.createElement(s.FaPencilAlt,{onClick:function(){return f(!0)},className:"RFC__Editable__Pencil__Text"}))):n.createElement(n.Fragment,null,c)},exports.ImageText=S,exports.ImageTextDefinition=y,exports.Login=function(e){var l=e.open,o=e.onClose,i=a.useAuth(),c=t.useState(""),u=c[0],s=c[1],m=t.useState(""),d=m[0],_=m[1],f=t.useCallback((function(e){null==e||e.preventDefault(),r.setPersistence(i,r.browserSessionPersistence).then((function(){return r.signInWithEmailAndPassword(i,u,d)})).then(o)}),[u,d,i,o]);return n.createElement(E,{title:"Login",open:l,onClose:o,buttons:[{label:"Login",action:f}]},n.createElement("form",{onSubmit:f,className:"RFC__LoginDialog__Content"},n.createElement("label",{htmlFor:"email"},"Email"),n.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},type:"email",id:"email"}),n.createElement("label",{htmlFor:"password"},"Password"),n.createElement("input",{value:d,onChange:function(e){return _(e.target.value)},type:"password",id:"password"})))},exports.Logout=function(e){var l=e.open,o=e.onClose,i=a.useAuth(),c=[{label:"Cancel",action:function(){return null==o?void 0:o()}},{label:"Logout",action:t.useCallback((function(){r.setPersistence(i,r.browserSessionPersistence).then((function(){return r.signOut(i)})).then(o)}),[i,o]),type:"warning"}];return n.createElement(E,{title:"Login",open:l,onClose:o,buttons:c},"Are you sure you wish to logout?")},exports.ReactFireCms=function(e){var t,a=e.children;return n.createElement(k.Provider,{value:(t=e.config,p({},t,{components:[].concat(t.components,[h,y])}))},n.createElement(N,null,n.createElement(R,null,a)))},exports.useConfig=w;
//# sourceMappingURL=react-fire-cms.cjs.production.min.js.map
