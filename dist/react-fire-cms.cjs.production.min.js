"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),a=require("reactfire"),r=require("firebase/auth"),o=require("firebase/database"),l=require("firebase/storage"),i=require("firebase/firestore"),c=require("react-icons/io5");require("react-draft-wysiwyg/dist/react-draft-wysiwyg.css");var u=require("react-hotkeys-hook"),s=require("react-icons/fa"),m=require("draft-js"),d=require("react-draft-wysiwyg"),_=e(require("draftjs-to-html")),f=e(require("html-to-draftjs"));function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var v=function(e){var t=e.title,a=e.children,r=e.buttons,o=e.onClose;return e.open?n.createElement(n.Fragment,null,n.createElement("div",{className:"RFCMS__AntiClick"}),n.createElement("div",{className:"RFCMS__Dialog"},n.createElement("div",{className:"RFCMS__Dialog__Header"},t,o&&n.createElement(c.IoCloseSharp,{onClick:o,className:"RFCMS__Dialog__Close"})),n.createElement("div",{className:"RFCMS__Dialog__Content"},a),r&&n.createElement("div",{className:"RFCMS__Dialog__Buttons"},null==r?void 0:r.map((function(e){return n.createElement("div",{key:e.label,className:"RFCMS__Dialog__Buttons__Button "+(e.disabled&&"RFCMS__Dialog__Buttons__Button--disabled")+" RFCMS__Dialog__Buttons__Button--"+e.type,onClick:function(){e.disabled||e.action()}},e.label)}))))):null},p=t.createContext(null),C=function(){return t.useContext(p)},g=function(){var e=a.useUser();return t.useMemo((function(){var t;return{user:null==e?void 0:e.data,userExists:!(null==e||null==(t=e.data)||!t.email)}}),[e])},S=function(e){var a=e.image,r=e.selected,o=e.onSelect,i=t.useState(""),c=i[0],u=i[1];return t.useEffect((function(){a&&l.getDownloadURL(a).then(u).catch(console.error)}),[a]),n.createElement("div",{onClick:function(){return o(c)},className:"RFCMS__MediaSelector__Item "+(r&&"RFCMS__MediaSelector__Item--Selected")},n.createElement("img",{src:c,alt:null==a?void 0:a.name,className:"RFCMS__MediaSelector__Item__Image"}),n.createElement("span",{className:"RFCMS__MediaSelector__Item__Text"},null==a?void 0:a.name))},y=function(e){var r=e.onSelect,o=C(),i=t.useState(""),c=i[0],u=i[1],s=t.useState(!1),m=s[0],d=s[1],_=t.useState([]),f=_[0],E=_[1],p=t.useState(-1),g=p[0],y=p[1],b=t.useState(""),F=b[0],h=b[1],k=a.useStorage(),D=t.useCallback((function(e){e.preventDefault(),d(!0)}),[d]);t.useEffect((function(){m&&l.listAll(l.ref(k,o.firebase.storage.bucket)).then((function(e){E(e.items)})).catch((function(e){return u(e)}))}),[k,m]);var M=t.useMemo((function(){return[{label:"Cancel",action:function(){return d(!1)}},{label:"Upload",action:function(){}},{label:"Select",action:function(){r(F),d(!1)},disabled:-1===g}]}),[r,g,F]);return n.createElement("div",null,n.createElement("button",{onClick:D},"Select Image"),m&&n.createElement(v,{buttons:M,title:"Media Gallery",open:m,onClose:function(){return d(!1)}},c&&n.createElement("span",{className:"RFCMS__TextStyles__Error"},c),n.createElement("div",{className:"RFCMS__MediaSelector__Grid"},f.map((function(e,t){return n.createElement(S,{onSelect:function(e){y(t),h(e)},selected:t===g,image:e})})))))},b=function(e){var t=e.onUpdate;return n.createElement("div",{className:"RFCMS__Editable__Dialog__Image"},n.createElement("input",{onChange:function(e){return t(e.target.value)},value:e.value}),n.createElement(y,{onSelect:t}))},F=function(e){var t=e.onUpdate;return n.createElement(n.Fragment,null,n.createElement("input",{type:"number",onChange:function(e){return t(e.target.value)},value:e.value}))},h={name:"Parallax",key:"parallax",component:function(e){var a=e.src,r=e.zoom,o=t.createRef(),l=t.useState(-1),i=l[0],c=l[1],u=t.useCallback((function(){var e,t,n=((null==(e=o.current)||null==(t=e.getBoundingClientRect())?void 0:t.top)||0)/window.innerHeight/2;c(n-1)}),[o]);return t.useEffect((function(){return window.addEventListener("scroll",u),function(){window.removeEventListener("scroll",u)}}),[u]),n.createElement("div",{ref:o,className:"RFCMS__Parallax"},n.createElement("div",{className:"RFCMS__Parallax__Inner",style:{backgroundImage:"url("+a+")",width:"100%",height:"calc(100% + "+2*r+"px)",backgroundPositionY:"calc("+r*i+"px)"}}))},Editor:function(e){var t=e.onDataSet,a=e.data,r=function(e,n){t({src:e||a.src,zoom:n||a.zoom})};return n.createElement("div",{className:"RFCMS__EditorStyles__Editor__Form"},n.createElement("span",null,"Source"),n.createElement(b,{value:null==a?void 0:a.src,onUpdate:function(e){return r(e)}}),n.createElement("span",null,"Zoom"),n.createElement(F,{value:null==a?void 0:a.zoom,onUpdate:function(e){return r(void 0,e)}}))}},k=function(e){var t=e.alt,a=e.style,r=e.imageStyle,o=e.textStyle,l=e.imageClass,i=e.textClass,c=e.src;return null!=c&&c.startsWith("http")?n.createElement("img",{src:c,style:E({},a,r),className:l,alt:t}):n.createElement("span",{style:E({},a,o),className:i},c)},D={name:"Image / Text",key:"imageText",component:k,Editor:function(e){var t=e.onDataSet,a=e.data;return n.createElement("div",{className:"RFCMS__EditorStyles__Editor__Form"},n.createElement("span",null,"Image URL / Text"),n.createElement(b,{value:a,onUpdate:t}))}},M=function(e){var t=e.children,r=C();return n.createElement(a.FirebaseAppProvider,{firebaseConfig:r.firebase.config},t)},R=function(e){var t=e.children,c=a.useFirebaseApp(),u=o.getDatabase(c),s=r.getAuth(c),m=l.getStorage(c),d=i.getFirestore(c);return n.createElement(a.AuthProvider,{sdk:s},n.createElement(a.DatabaseProvider,{sdk:u},n.createElement(a.StorageProvider,{sdk:m},n.createElement(a.FirestoreProvider,{sdk:d},t))))},N=function(e){var t=e.onUpdate;return n.createElement(n.Fragment,null,n.createElement("input",{onChange:function(e){return t(e.target.value)},value:e.value}))},x=function(e){var t=e.onUpdate,a=f(e.value),r=m.ContentState.createFromBlockArray(a.contentBlocks,a.entityMap),o=m.EditorState.createWithContent(r);return n.createElement(n.Fragment,null,n.createElement("div",{className:"RFCMS__Editable__Dialog__RichEditor"},n.createElement(d.Editor,{defaultEditorState:o,onEditorStateChange:function(e){t(_(m.convertToRaw(e.getCurrentContent())))}})))},w=function(e){var t,a=e.onUpdate,r=e.value,o=C(),l=null==r?void 0:r.component,i=null==r?void 0:r.props,c=function(e,t){a({component:e||(null==r?void 0:r.component),props:t||(null==r?void 0:r.props)})},u=null==(t=o.components.find((function(e){return e.key===l})))?void 0:t.Editor;return n.createElement(n.Fragment,null,n.createElement("select",{value:l,onChange:function(e){return c(e.target.value)}},n.createElement("option",null,"Select a Component"),o.components.map((function(e,t){return n.createElement("option",{key:e.key+"_"+t,value:e.key},e.name)}))),u&&n.createElement(u,{onDataSet:function(e){return c(void 0,e)},data:i}))},P=function(e){var t=e.cells;return n.createElement(n.Fragment,null,null==t||null==t.map?void 0:t.map((function(e){return n.createElement(q,{content:e.description})})))},U={name:"DynamicLayout",key:"dynamicLayout",component:P,Editor:function(e){var a=e.onDataSet,r=e.data,o=t.useCallback((function(e){e.preventDefault(),a([].concat(r||[],[{description:{component:void 0,props:{}},size:"100%"}]))}),[r]),l=t.useCallback((function(e){var t=[].concat(r.slice(0,e),r.slice(e+1));a(t)}),[r]),i=t.useCallback((function(e,t,n){var o=[].concat(r.slice(0,e),[{description:t||r[e].description,size:n||r[e].size}],r.slice(e+1));a(o)}),[r]);return n.createElement("div",{className:"RFCMS__EditorStyles__Editor__Form"},n.createElement("button",{onClick:o},"Add Row"),n.createElement("div",null,null==r?void 0:r.map((function(e,t){return n.createElement("div",{key:t+"_",className:"RFCMS__DynamicLayout__Editor"},n.createElement("div",{className:"RFCMS__DynamicLayout__Editor__Header"},n.createElement("label",null,"Size (See guide for accepted formats)"),n.createElement(N,{value:e.size,onUpdate:function(e){return i(t,void 0,e)}}),n.createElement(c.IoCloseCircle,{className:"RFCMS__DynamicLayout__Editor__Header__Delete",onClick:function(){return l(t)}})),n.createElement(A.Editor,{onDataSet:function(e){return i(t,e)},data:e.description}))}))))}},L=function(e){var t=e.onUpdate,a=e.value,r=function(e,n){t({content:e||a.content,url:n||a.url})};return n.createElement(n.Fragment,null,n.createElement("input",{onChange:function(e){return r(e.target.value)},value:a.content}),n.createElement("input",{onChange:function(e){return r(void 0,e.target.value)},value:a.url}))},I=function(e){var a=e.onUpdate,r=e.value,o=t.useCallback((function(e){e.preventDefault(),a([].concat(r||[],[{url:"",content:""}]))}),[r]),l=t.useCallback((function(e){var t=[].concat(r.slice(0,e),r.slice(e+1));a(t)}),[r]),i=t.useCallback((function(e,t){var n=[].concat(r.slice(0,e),[E({},t)],r.slice(e+1));a(n)}),[r]);return n.createElement("div",{className:"RFCMS__EditorStyles__Editor__Form"},n.createElement("button",{onClick:o},"Add Menu Item"),n.createElement("div",null,null==r?void 0:r.map((function(e,t){return n.createElement("div",{key:t+"_",className:"RFCMS__MenuEditor__Editor"},n.createElement("div",{className:"RFCMS__MenuEditor__Editor__Row"},n.createElement(L,{onUpdate:function(e){return i(t,e)},value:e}),n.createElement(c.IoCloseCircle,{className:"RFCMS__DynamicLayout__Editor__Header__Delete",onClick:function(){return l(t)}})))}))))},H=function(e){var r=e.open,o=e.fields,l=e.path,c=e.onClose,u=a.useFirestore(),s=i.doc(u,l),m=a.useFirestoreDocData(s),d=t.useState(""),_=d[0],f=d[1],p=t.useState({}),C=p[0],g=p[1];t.useEffect((function(){g(o.reduce((function(e,t){var n,a=e;return a[t.name]=(null==(n=m.data)?void 0:n[t.name])||void 0,a}),{}))}),[o,m]);var S=function(e){null==e||e.preventDefault(),console.error("Submitting: ",C),i.setDoc(s,C,{merge:!0}).then(c).catch((function(e){return f(e)}))},y=t.useCallback((function(e,t){var n=E({},C);n[e]=t,g(n)}),[C]),b=[{label:"Cancel",action:function(){return null==c?void 0:c()}},{label:"Save",action:S}];return n.createElement(v,Object.assign({title:"Edit Fields"},{onClose:c,open:r},{buttons:b}),r&&n.createElement("form",{className:"RFCMS__Editable__Dialog",onSubmit:S},n.createElement("span",{className:"Text__Error"},_),null==o?void 0:o.map((function(e){return n.createElement("div",{key:e.name,className:"RFCMS__Editable__Dialog__Field"},n.createElement("div",{className:"RFCMS__Editable__Dialog__Label"},e.hint||e.name),function(e){switch(e.type){case"string":return n.createElement(N,{onUpdate:function(t){return y(e.name,t)},value:C[e.name]});case"image":return n.createElement(D.Editor,{onDataSet:function(t){return y(e.name,t)},data:C[e.name]});case"longform":return n.createElement(x,{onUpdate:function(t){return y(e.name,t)},value:C[e.name]});case"component":return n.createElement(w,{onUpdate:function(t){return y(e.name,t)},value:C[e.name]});case"dynamicLayout":return n.createElement(U.Editor,{onDataSet:function(t){return y(e.name,t)},data:C[e.name]});case"url":return n.createElement(L,{onUpdate:function(t){return y(e.name,t)},value:C[e.name]});case"menu":return n.createElement(I,{onUpdate:function(t){return y(e.name,t)},value:C[e.name]});default:return n.createElement(n.Fragment,null)}}(e))}))))},q=function(e){var t,a=e.content,r=e.className,o=e.style,l=C(),i=null==a?void 0:a.component,c=(null==a?void 0:a.props)||{},u=null==(t=l.components.find((function(e){return e.key===i})))?void 0:t.component;return u?n.createElement(u,Object.assign({},c,{className:r,style:o})):n.createElement(n.Fragment,null)},A={name:"Dynamic Component",key:"dynamicComponent",component:q,Editor:function(e){var t=e.onDataSet,a=e.data;return n.createElement("div",{className:"RFCMS__EditorStyles__Editor__Form"},n.createElement("span",null,"Component"),n.createElement(w,{value:a,onUpdate:t}))}},T=function(e){var a=e.open,r=e.identity,o=e.onClose,l=e.onDelete,i=[{label:"Cancel",action:function(){return null==o?void 0:o()}},{label:"Delete",action:t.useCallback((function(){l().then(o)}),[l,o]),type:"warning"}];return n.createElement(v,{title:"Delete "+r,open:a,onClose:o,buttons:i},"Do you wish to delete ",r)};exports.Deleter=function(e){var r=e.style,o=e.className,l=e.path,c=e.children,m=g().userExists,d=t.useState(!1),_=d[0],f=d[1],E=t.useState(!1),v=E[0],p=E[1],C=t.useState(!1),S=C[0],y=C[1],b=a.useFirestore();return u.useHotkeys("e",(function(){p(!0)})),u.useHotkeys("e",(function(){p(!1)}),{keydown:!1,keyup:!0}),u.useHotkeys("p",(function(){y(!0)})),u.useHotkeys("p",(function(){y(!1)}),{keydown:!1,keyup:!0}),m?n.createElement("div",{style:r,className:o+" RFCMS__Editable "+(S&&"RFCMS__Editable--Preview")},n.createElement(T,{open:_,identity:"this page",onClose:function(){return f(!1)},onDelete:function(){return i.deleteDoc(i.doc(b,l))}}),n.createElement("div",{className:"RFCMS__Editable__Trash "+(v&&"RFCMS__Editable__Trash--Highlight")+"  "+(S&&"RFCMS__Editable__Pencil--Preview")},n.createElement(s.FaTrash,{onClick:function(){return f(!0)},className:"RFCMS__Editable__Pencil__Text"}))):n.createElement(n.Fragment,null,c)},exports.Dialog=v,exports.DynamicComponent=q,exports.DynamicComponentDefinition=A,exports.DynamicLayout=P,exports.DynamicLayoutDefinition=U,exports.Editable=function(e){var r=e.fields,o=e.style,l=e.path,i=e.className,c=e.children,m=a.useUser(),d=t.useState(!1),_=d[0],f=d[1],E=t.useState(!1),v=E[0],p=E[1],C=t.useState(!1),g=C[0],S=C[1];return u.useHotkeys("e",(function(){p(!0)})),u.useHotkeys("e",(function(){p(!1)}),{keydown:!1,keyup:!0}),u.useHotkeys("p",(function(){S(!0)})),u.useHotkeys("p",(function(){S(!1)}),{keydown:!1,keyup:!0}),m.data?n.createElement("div",{style:o,className:i+" RFCMS__Editable "+(g&&"RFCMS__Editable--Preview")},c,n.createElement(H,{path:l,open:_,fields:r,onClose:function(){return f(!1)}}),n.createElement("div",{className:"RFCMS__Editable__Pencil "+(v&&"RFCMS__Editable__Pencil--Highlight")+" "+(g&&"RFCMS__Editable__Pencil--Preview")},n.createElement(s.FaPencilAlt,{onClick:function(){return f(!0)},className:"RFCMS__Editable__Pencil__Text"}))):n.createElement(n.Fragment,null,c)},exports.ImageText=k,exports.ImageTextDefinition=D,exports.Login=function(e){var o=e.open,l=e.onClose,i=a.useAuth(),c=t.useState(""),u=c[0],s=c[1],m=t.useState(""),d=m[0],_=m[1],f=t.useCallback((function(e){null==e||e.preventDefault(),r.setPersistence(i,r.browserSessionPersistence).then((function(){return r.signInWithEmailAndPassword(i,u,d)})).then(l)}),[u,d,i,l]);return n.createElement(v,{title:"Login",open:o,onClose:l,buttons:[{label:"Login",action:f}]},n.createElement("form",{onSubmit:f,className:"RFCMS__LoginDialog__Content"},n.createElement("label",{htmlFor:"email"},"Email"),n.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},type:"email",id:"email"}),n.createElement("label",{htmlFor:"password"},"Password"),n.createElement("input",{value:d,onChange:function(e){return _(e.target.value)},type:"password",id:"password"})))},exports.Logout=function(e){var o=e.open,l=e.onClose,i=a.useAuth(),c=[{label:"Cancel",action:function(){return null==l?void 0:l()}},{label:"Logout",action:t.useCallback((function(){r.setPersistence(i,r.browserSessionPersistence).then((function(){return r.signOut(i)})).then(l)}),[i,l]),type:"warning"}];return n.createElement(v,{title:"Login",open:o,onClose:l,buttons:c},"Are you sure you wish to logout?")},exports.ReactFireCMS=function(e){var t,a=e.children;return n.createElement(p.Provider,{value:(t=e.config,E({},t,{components:[].concat(t.components,[h,D])}))},n.createElement(M,null,n.createElement(R,null,a)))},exports.useConfig=C,exports.useDocument=function(e){var t=a.useFirestore(),n=i.doc(t,""+e),r=a.useFirestoreDocData(n).data;return console.error(Object.keys(r||{}),r),{data:r,pageExists:Object.keys(r||{}).length>0}},exports.useField=function(e,n){var r=a.useFirestore(),o=i.doc(r,e),l=a.useFirestoreDocData(o).data;return t.useMemo((function(){return null==l?void 0:l[n]}),[l])},exports.useUser=g;
//# sourceMappingURL=react-fire-cms.cjs.production.min.js.map
